<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Tool Platform - Live Demo</title>
    <script src="https://unpkg.com/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #28a745;
        }

        .api-info {
            font-size: 0.9em;
            color: #6c757d;
            font-family: monospace;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 350px;
            gap: 20px;
            padding: 20px;
            min-height: 700px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #dee2e6;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .file-upload-section {
            margin-bottom: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px dashed #3498db;
        }

        .upload-area {
            text-align: center;
            padding: 20px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .scenario-selector {
            margin-bottom: 20px;
        }

        .scenario-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .scenario-btn.active {
            background: #e74c3c;
        }

        .scenario-btn:hover {
            background: #7f8c8d;
        }

        .agent-thoughts {
            max-height: 500px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .thought-item {
            margin-bottom: 15px;
            padding: 12px;
            border-left: 4px solid #3498db;
            background: #f1f2f6;
            border-radius: 0 8px 8px 0;
            animation: slideIn 0.3s ease-out;
        }

        .thought-item.tool-execution {
            border-left-color: #e74c3c;
        }

        .thought-item.decision-point {
            border-left-color: #f39c12;
        }

        .thought-item.collaboration {
            border-left-color: #9b59b6;
        }

        .thought-item.processing {
            border-left-color: #27ae60;
        }

        .thought-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .agent-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .timestamp {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .thought-content {
            color: #34495e;
            line-height: 1.4;
        }

        .api-response {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            margin-top: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .tools-panel {
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .tool-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .tool-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .tool-desc {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .tool-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .tool-status.ready {
            background: #d4edda;
            color: #155724;
        }

        .tool-status.processing {
            background: #fff3cd;
            color: #856404;
            animation: pulse 1s infinite;
        }

        .tool-status.complete {
            background: #cce5ff;
            color: #004085;
        }

        .tool-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .demo-controls {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.success:hover {
            background: #2ecc71;
        }

        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        .demo-scenarios {
            margin-top: 20px;
        }

        .scenario-card {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            border: 2px solid #dee2e6;
            animation: slideIn 0.3s ease-out;
        }

        .scenario-card.active {
            display: block;
            border-color: #3498db;
        }

        .scenario-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .scenario-card p {
            color: #34495e;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .insights-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }

        .insights-panel h3 {
            color: #155724;
            margin-bottom: 15px;
        }

        .insight-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }

        .violation-item {
            background: #fff5f5;
            border-left-color: #e53e3e;
            color: #c53030;
        }

        .recommendation-item {
            background: #f0fff4;
            border-left-color: #38a169;
            color: #2f855a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Universal AI Tool Platform</h1>
            <p>Real-time transparent AI orchestration with live MCP backend integration</p>
        </div>

        <div class="status-bar">
            <div class="connection-status">
                <div class="status-indicator" id="connectionStatus"></div>
                <span id="connectionText">Checking API...</span>
            </div>
            <div class="api-info">
                Backend: <span id="apiUrl">https://func-pdfai-dev-tjqwgu4v.azurewebsites.net/api</span>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Panel: File Upload & Processing -->
            <div class="panel">
                <h2>üìÑ Document Processing</h2>
                
                <div class="file-upload-section">
                    <div class="upload-area">
                        <p>üìÅ Upload documents or enter URL for AI processing</p>
                        <input type="text" id="urlInput" placeholder="Enter PDF/CSV URL (recommended for large files)" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
                        <input type="file" id="fileInput" class="file-input" accept=".pdf,.csv" multiple>
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            Choose Files
                        </button>
                        <button class="upload-btn" id="processBtn" onclick="processFile()" disabled>
                            üöÄ Process File
                        </button>
                        <button class="upload-btn" onclick="testWithSamplePDF()">
                            üß™ Test Sample
                        </button>
                    </div>
                    <div id="fileInfo"></div>
                </div>

                <div class="scenario-selector">
                    <h3>üéØ Demo Scenarios - Choose Your Pitch:</h3>
                    <button class="scenario-btn active" data-scenario="compliance" onclick="selectScenario('compliance')">
                        üèõÔ∏è Regulatory Compliance
                        <div style="font-size: 0.7em; margin-top: 2px;">NERC CIP ‚Ä¢ EPA ‚Ä¢ PUC Analysis</div>
                    </button>
                    <button class="scenario-btn" data-scenario="customer" onclick="selectScenario('customer')">
                        üë• Customer Experience
                        <div style="font-size: 0.7em; margin-top: 2px;">Journey Mapping ‚Ä¢ Sentiment</div>
                    </button>
                    <button class="scenario-btn" data-scenario="operations" onclick="selectScenario('operations')">
                        ‚ö° Operations Intelligence
                        <div style="font-size: 0.7em; margin-top: 2px;">Document Processing</div>
                    </button>
                    <button class="scenario-btn" data-scenario="financial" onclick="selectScenario('financial')">
                        üí∞ Financial Analytics
                        <div style="font-size: 0.7em; margin-top: 2px;">Coming Soon</div>
                    </button>
                </div>
                
                <div class="demo-scenarios" id="demoScenarios">
                    <div class="scenario-card active" data-scenario="compliance">
                        <h4>üèõÔ∏è Regulatory Compliance Scenario</h4>
                        <p><strong>Pitch:</strong> "Our AI automatically analyzes utility documents against all major regulations and provides actionable remediation plans with cost estimates."</p>
                        <button class="upload-btn" onclick="runComplianceDemo()">üöÄ Run Compliance Demo</button>
                    </div>
                    
                    <div class="scenario-card" data-scenario="customer">
                        <h4>üë• Customer Experience Scenario</h4>
                        <p><strong>Pitch:</strong> "Track customer journeys across all channels, identify pain points, and get AI-powered recommendations to improve satisfaction."</p>
                        <button class="upload-btn" onclick="runCustomerDemo()">üöÄ Run Customer Demo</button>
                    </div>
                    
                    <div class="scenario-card" data-scenario="operations">
                        <h4>‚ö° Operations Intelligence Scenario</h4>
                        <p><strong>Pitch:</strong> "Extract structured data from any utility document and gain instant insights for operational decisions."</p>
                        <button class="upload-btn" onclick="runOperationsDemo()">üöÄ Run Operations Demo</button>
                    </div>
                    
                    <div class="scenario-card" data-scenario="financial">
                        <h4>üí∞ Financial Analytics Scenario</h4>
                        <p><strong>Coming Soon:</strong> Billing analytics, revenue optimization, and financial reporting automation.</p>
                        <button class="upload-btn" disabled>üîß In Development</button>
                    </div>
                </div>

                <div class="agent-thoughts" id="thoughtsContainer">
                    <div class="thought-item">
                        <div class="thought-header">
                            <span class="agent-name">System</span>
                            <span class="timestamp">Ready</span>
                        </div>
                        <div class="thought-content">
                            üéØ Universal AI Tool Platform ready. Upload a file to see transparent AI orchestration in action.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Middle Panel: Real-time Agent Thoughts -->
            <div class="panel">
                <h2>üß† Agent Transparency</h2>
                <div class="agent-thoughts" id="liveThoughtsContainer">
                    <div class="thought-item">
                        <div class="thought-header">
                            <span class="agent-name">AI Orchestrator</span>
                            <span class="timestamp">Waiting...</span>
                        </div>
                        <div class="thought-content">
                            Ready to demonstrate real-time AI thinking and decision-making process.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: System Overview & Tools -->
            <div class="panel">
                <h2>üìä System Status</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="apiCalls">0</div>
                        <div class="metric-label">API Calls</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="activeTools">6</div>
                        <div class="metric-label">Active Tools</div>
                    </div>
                </div>

                <h3 style="margin-top: 20px; margin-bottom: 15px; color: #2c3e50;">üõ†Ô∏è MCP Tools</h3>
                <div class="tools-panel" id="toolsContainer">
                    <!-- Tools will be loaded dynamically -->
                </div>

                <div id="insightsPanel" class="insights-panel" style="display: none;">
                    <h3>üéØ AI Insights & Outcomes</h3>
                    <div id="insightsContent">
                        <!-- Dynamic insights will be displayed here -->
                    </div>
                </div>

                <div class="demo-controls">
                    <button class="btn" onclick="testHealthCheck()">
                        üè• Health Check
                    </button>
                    <button class="btn" onclick="loadTools()">
                        üîÑ Refresh Tools
                    </button>
                    <button class="btn" onclick="clearLogs()">
                        üóëÔ∏è Clear Logs
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üîí Enterprise-Ready AI Transparency Platform | Powered by Azure Functions & MCP Tools</p>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://func-pdfai-dev-tjqwgu4v.azurewebsites.net/api';
        let selectedScenario = 'compliance';
        let apiCallCount = 0;
        let currentFile = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await testAPIConnection();
            await loadTools();
            setupFileUpload();
        });

        // API Connection Test
        async function testAPIConnection() {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    statusIndicator.classList.add('connected');
                    statusText.textContent = `Connected - ${data.service}`;
                    addThought('system', 'API Connection', `‚úÖ Connected to backend API: ${data.service} v${data.version}`);
                } else {
                    throw new Error('API returned error status');
                }
            } catch (error) {
                statusIndicator.classList.remove('connected');
                statusText.textContent = 'API Connection Failed';
                addThought('system', 'API Connection', `‚ùå Failed to connect to backend API: ${error.message}`, 'error');
            }
        }

        // Load MCP Tools
        async function loadTools() {
            try {
                const response = await fetch(`${API_BASE_URL}/tools`);
                const data = await response.json();
                
                if (response.ok && data.tools) {
                    renderTools(data.tools);
                    document.getElementById('activeTools').textContent = data.tools.length;
                    addThought('system', 'Tools Loaded', `üõ†Ô∏è Loaded ${data.tools.length} MCP tools successfully`);
                } else {
                    throw new Error('Failed to load tools');
                }
            } catch (error) {
                addThought('system', 'Tools Error', `‚ùå Failed to load MCP tools: ${error.message}`, 'error');
            }
        }

        // Render Tools Panel
        function renderTools(tools) {
            const container = document.getElementById('toolsContainer');
            container.innerHTML = '';
            
            tools.forEach(tool => {
                const toolElement = document.createElement('div');
                toolElement.className = 'tool-item';
                toolElement.innerHTML = `
                    <div>
                        <div class="tool-name">${tool.name.replace(/_/g, ' ').toUpperCase()}</div>
                        <div class="tool-desc">${tool.description.substring(0, 60)}...</div>
                    </div>
                    <span class="tool-status ready">Ready</span>
                `;
                container.appendChild(toolElement);
            });
        }

        // File Upload Setup
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const urlInput = document.getElementById('urlInput');
            const processBtn = document.getElementById('processBtn');
            const fileInfo = document.getElementById('fileInfo');
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    currentFile = file;
                    urlInput.value = '';
                    processBtn.disabled = false;
                    fileInfo.innerHTML = `
                        <div class="success-message">
                            üìÑ Selected: ${file.name} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                    `;
                    addThought('user', 'File Selected', `üìé Selected ${file.name} for processing`);
                }
            });
            
            urlInput.addEventListener('input', function(e) {
                if (e.target.value.trim()) {
                    currentFile = null;
                    fileInput.value = '';
                    processBtn.disabled = false;
                    fileInfo.innerHTML = `
                        <div class="success-message">
                            üåê URL: ${e.target.value}
                        </div>
                    `;
                    addThought('user', 'URL Entered', `üîó Entered URL for processing: ${e.target.value}`);
                } else {
                    processBtn.disabled = true;
                    fileInfo.innerHTML = '';
                }
            });
        }

        // Process File
        async function processFile() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!currentFile && !url) return;
            
            const source = currentFile ? currentFile.name : url;
            addThought('orchestrator', 'Processing Started', `üöÄ Starting ${selectedScenario} analysis for ${source}`);
            
            // Simulate AI thinking process
            const fileType = currentFile ? currentFile.type : (url.toLowerCase().includes('.pdf') ? 'PDF' : 'CSV');
            addLiveThought('orchestrator', 'Decision Making', `ü§î Analyzing input type: ${fileType}`);
            await sleep(1000);
            
            addLiveThought('orchestrator', 'Tool Selection', `üéØ Selected ${selectedScenario} processing pipeline`);
            await sleep(1000);
            
            if ((currentFile && currentFile.name.toLowerCase().endsWith('.pdf')) || (url && url.toLowerCase().includes('.pdf'))) {
                await processPDF(url);
            } else if ((currentFile && currentFile.name.toLowerCase().endsWith('.csv')) || (url && url.toLowerCase().includes('.csv'))) {
                await processCSV(url);
            } else {
                addThought('error', 'File Type Error', '‚ùå Unsupported file type. Please upload PDF or CSV files.', 'error');
            }
        }

        // Process PDF
        async function processPDF(url = null) {
            updateToolStatus('process_pdf', 'processing');
            addLiveThought('pdf-agent', 'Tool Execution', 'üìÑ Initializing PDF processor...');
            
            try {
                let filePath;
                
                if (url) {
                    // Use URL directly
                    filePath = url;
                    addLiveThought('pdf-agent', 'URL Processing', 'üåê Processing PDF from URL (recommended for large files)');
                } else {
                    // Convert file to base64
                    const dataUrl = await fileToBase64(currentFile);
                    // Extract base64 content without data URL prefix
                    filePath = dataUrl.split(',')[1];
                    addLiveThought('pdf-agent', 'Data Conversion', 'üîÑ Converting PDF to base64 for API transmission');
                }
                
                await sleep(1500);
                
                // Call PDF processing API with correct parameter structure
                const payload = {
                    parameters: {
                        file_path: filePath,
                        analysis_type: 'comprehensive'
                    }
                };
                
                addLiveThought('pdf-agent', 'API Call', 'üì° Sending PDF to Azure Document Intelligence...');
                
                const response = await fetch(`${API_BASE_URL}/tools/process_pdf`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                apiCallCount++;
                document.getElementById('apiCalls').textContent = apiCallCount;
                
                const result = await response.json();
                
                if (response.ok) {
                    updateToolStatus('process_pdf', 'complete');
                    addThought('pdf-agent', 'Processing Complete', '‚úÖ PDF analysis completed successfully');
                    
                    addLiveThought('pdf-agent', 'Results Analysis', `üìä Extracted ${JSON.stringify(result).length} characters of structured data`);
                    
                    // Show API response
                    addThought('api-response', 'PDF API Response', '', 'processing', JSON.stringify(result, null, 2));
                    
                    // Trigger compliance analysis based on scenario
                    if (selectedScenario === 'compliance') {
                        await sleep(1000);
                        await triggerComplianceAnalysis(result);
                    }
                } else {
                    throw new Error(result.message || 'PDF processing failed');
                }
                
            } catch (error) {
                updateToolStatus('process_pdf', 'error');
                addThought('pdf-agent', 'Processing Failed', `‚ùå PDF processing error: ${error.message}`, 'error');
            }
        }

        // Process CSV
        async function processCSV() {
            updateToolStatus('analyze_csv', 'processing');
            addLiveThought('csv-agent', 'Tool Execution', 'üìä Initializing CSV analyzer...');
            
            try {
                const csvContent = await fileToText(currentFile);
                addLiveThought('csv-agent', 'Data Loading', `üî¢ Loaded CSV with ${csvContent.split('\n').length} rows`);
                
                await sleep(1500);
                
                const payload = {
                    parameters: {
                        csv_data: csvContent,
                        analysis_type: 'comprehensive',
                        include_recommendations: true
                    }
                };
                
                addLiveThought('csv-agent', 'Statistical Analysis', 'üìà Performing statistical analysis and data quality assessment...');
                
                const response = await fetch(`${API_BASE_URL}/tools/analyze_csv`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                apiCallCount++;
                document.getElementById('apiCalls').textContent = apiCallCount;
                
                const result = await response.json();
                
                if (response.ok) {
                    updateToolStatus('analyze_csv', 'complete');
                    addThought('csv-agent', 'Analysis Complete', '‚úÖ CSV analysis completed with insights');
                    
                    addLiveThought('csv-agent', 'Insights Generated', 'üí° Generated actionable insights and recommendations');
                    
                    // Show API response
                    addThought('api-response', 'CSV API Response', '', 'processing', JSON.stringify(result, null, 2));
                } else {
                    throw new Error(result.message || 'CSV analysis failed');
                }
                
            } catch (error) {
                updateToolStatus('analyze_csv', 'error');
                addThought('csv-agent', 'Analysis Failed', `‚ùå CSV analysis error: ${error.message}`, 'error');
            }
        }

        // Trigger Compliance Analysis
        async function triggerComplianceAnalysis(pdfResult) {
            updateToolStatus('compliance_analyzer', 'processing');
            addLiveThought('compliance-agent', 'Compliance Check', '‚öñÔ∏è Initiating regulatory compliance analysis...');
            
            try {
                const payload = {
                    parameters: {
                        compliance_domain: 'comprehensive',
                        document_content: JSON.stringify(pdfResult),
                        include_remediation: true
                    }
                };
                
                addLiveThought('compliance-agent', 'Regulatory Scan', 'üîç Scanning for NERC CIP, EPA, and state utility regulations...');
                
                const response = await fetch(`${API_BASE_URL}/tools/compliance_analyzer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                apiCallCount++;
                document.getElementById('apiCalls').textContent = apiCallCount;
                
                const result = await response.json();
                
                if (response.ok) {
                    updateToolStatus('compliance_analyzer', 'complete');
                    addLiveThought('compliance-agent', 'Compliance Complete', '‚úÖ Compliance analysis completed with recommendations');
                    
                    // Show API response
                    addThought('api-response', 'Compliance API Response', '', 'processing', JSON.stringify(result, null, 2));
                } else {
                    throw new Error(result.message || 'Compliance analysis failed');
                }
                
            } catch (error) {
                updateToolStatus('compliance_analyzer', 'error');
                addThought('compliance-agent', 'Compliance Failed', `‚ùå Compliance analysis error: ${error.message}`, 'error');
            }
        }

        // Scenario Selection
        function selectScenario(scenario) {
            selectedScenario = scenario;
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.scenario === scenario);
            });
            
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.toggle('active', card.dataset.scenario === scenario);
            });
            
            addThought('user', 'Scenario Changed', `üéØ Switched to ${scenario.charAt(0).toUpperCase() + scenario.slice(1)} scenario`);
            
            // Hide insights when switching scenarios
            document.getElementById('insightsPanel').style.display = 'none';
        }

        // Health Check
        async function testHealthCheck() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                apiCallCount++;
                document.getElementById('apiCalls').textContent = apiCallCount;
                
                if (response.ok) {
                    addThought('system', 'Health Check', `‚úÖ System healthy - ${data.service} v${data.version}`, 'processing');
                } else {
                    addThought('system', 'Health Check', '‚ùå System health check failed', 'error');
                }
            } catch (error) {
                addThought('system', 'Health Check', `‚ùå Health check error: ${error.message}`, 'error');
            }
        }

        // Utility Functions
        function addThought(agent, title, content, type = 'processing', apiResponse = null) {
            const container = document.getElementById('thoughtsContainer');
            const thoughtItem = document.createElement('div');
            thoughtItem.className = `thought-item ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            thoughtItem.innerHTML = `
                <div class="thought-header">
                    <span class="agent-name">${agent}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="thought-content">
                    <strong>${title}:</strong> ${content}
                    ${apiResponse ? `<div class="api-response">${apiResponse}</div>` : ''}
                </div>
            `;
            
            container.appendChild(thoughtItem);
            container.scrollTop = container.scrollHeight;
        }

        function addLiveThought(agent, title, content, type = 'processing') {
            const container = document.getElementById('liveThoughtsContainer');
            const thoughtItem = document.createElement('div');
            thoughtItem.className = `thought-item ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            thoughtItem.innerHTML = `
                <div class="thought-header">
                    <span class="agent-name">${agent}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="thought-content">
                    <strong>${title}:</strong> ${content}
                </div>
            `;
            
            container.appendChild(thoughtItem);
            container.scrollTop = container.scrollHeight;
        }

        function updateToolStatus(toolName, status) {
            const toolItems = document.querySelectorAll('.tool-item');
            toolItems.forEach(item => {
                const nameElement = item.querySelector('.tool-name');
                if (nameElement && nameElement.textContent.toLowerCase().includes(toolName.replace('_', ' '))) {
                    const statusElement = item.querySelector('.tool-status');
                    statusElement.className = `tool-status ${status}`;
                    statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                }
            });
        }

        function clearLogs() {
            document.getElementById('thoughtsContainer').innerHTML = `
                <div class="thought-item">
                    <div class="thought-header">
                        <span class="agent-name">System</span>
                        <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <div class="thought-content">
                        üóëÔ∏è Logs cleared. Ready for new processing session.
                    </div>
                </div>
            `;
            
            document.getElementById('liveThoughtsContainer').innerHTML = `
                <div class="thought-item">
                    <div class="thought-header">
                        <span class="agent-name">AI Orchestrator</span>
                        <span class="timestamp">Ready</span>
                    </div>
                    <div class="thought-content">
                        Ready for next transparent AI demonstration.
                    </div>
                </div>
            `;
        }

        // File conversion utilities
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function fileToText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsText(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Test with sample PDF
        function testWithSamplePDF() {
            const urlInput = document.getElementById('urlInput');
            urlInput.value = 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';
            urlInput.dispatchEvent(new Event('input'));
            addThought('system', 'Sample Test', 'üß™ Loaded sample PDF for testing: W3C dummy.pdf');
        }

        // Demo Functions
        async function runComplianceDemo() {
            addThought('demo-orchestrator', 'Compliance Demo Started', 'üèõÔ∏è Starting regulatory compliance demonstration...');
            addLiveThought('compliance-agent', 'Scenario Setup', 'Simulating utility document compliance analysis');
            
            const sampleDocument = "ACME Utilities Power Generation and Transmission Systems Report. This document outlines our electrical infrastructure including power plants, transmission lines, and distribution networks. We operate under NERC CIP regulations and maintain EPA compliance for environmental standards.";
            
            await sleep(2000);
            
            try {
                const payload = {
                    parameters: {
                        compliance_domain: 'comprehensive',
                        document_content: sampleDocument,
                        include_remediation: true
                    }
                };
                
                const response = await fetch(`${API_BASE_URL}/tools/compliance_analyzer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                displayComplianceInsights(result.result);
                
                addThought('compliance-agent', 'Demo Complete', '‚úÖ Compliance analysis demonstrates real regulatory intelligence');
            } catch (error) {
                addThought('demo-orchestrator', 'Demo Error', `‚ùå ${error.message}`, 'error');
            }
        }

        async function runCustomerDemo() {
            addThought('demo-orchestrator', 'Customer Demo Started', 'üë• Starting customer experience demonstration...');
            addLiveThought('customer-agent', 'Journey Analysis', 'Analyzing multi-channel customer interactions');
            
            const sampleJourney = [
                {
                    customer_id: "CUST12345",
                    channel: "web",
                    interaction_type: "billing_inquiry",
                    timestamp: "2024-01-15T09:30:00Z",
                    sentiment: "negative",
                    outcome: "unresolved"
                },
                {
                    customer_id: "CUST12345", 
                    channel: "phone",
                    interaction_type: "billing_inquiry",
                    timestamp: "2024-01-15T14:20:00Z",
                    sentiment: "neutral",
                    outcome: "escalated"
                },
                {
                    customer_id: "CUST12345",
                    channel: "chat",
                    interaction_type: "billing_inquiry", 
                    timestamp: "2024-01-16T10:15:00Z",
                    sentiment: "positive",
                    outcome: "resolved"
                }
            ];
            
            await sleep(2000);
            
            try {
                const payload = {
                    parameters: {
                        customer_interactions: sampleJourney,
                        include_journey_mapping: true,
                        include_sentiment_analysis: true
                    }
                };
                
                const response = await fetch(`${API_BASE_URL}/tools/omnichannel_analyzer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                displayCustomerInsights(result.result);
                
                addThought('customer-agent', 'Demo Complete', '‚úÖ Customer journey analysis shows actionable insights');
            } catch (error) {
                addThought('demo-orchestrator', 'Demo Error', `‚ùå ${error.message}`, 'error');
            }
        }

        async function runOperationsDemo() {
            addThought('demo-orchestrator', 'Operations Demo Started', '‚ö° Starting operations intelligence demonstration...');
            
            const urlInput = document.getElementById('urlInput');
            urlInput.value = 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';
            urlInput.dispatchEvent(new Event('input'));
            
            await sleep(1000);
            await processPDF('https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf');
        }

        function displayComplianceInsights(data) {
            const panel = document.getElementById('insightsPanel');
            const content = document.getElementById('insightsContent');
            
            const criticalViolations = data.violations.filter(v => v.severity === 'critical').length;
            const totalPenalty = data.violations.reduce((sum, v) => {
                const penalty = v.potential_penalty.match(/\$([0-9,]+)/);
                return sum + (penalty ? parseInt(penalty[1].replace(/,/g, '')) : 0);
            }, 0);
            
            content.innerHTML = `
                <div class="insight-item">
                    <strong>üìä Compliance Score:</strong> ${data.overall_score}/100 (${data.risk_level.toUpperCase()} Risk)
                </div>
                <div class="insight-item violation-item">
                    <strong>‚ö†Ô∏è Critical Violations:</strong> ${criticalViolations} found
                    <br><small>Potential Penalties: $${totalPenalty.toLocaleString()}+ per day</small>
                </div>
                <div class="insight-item">
                    <strong>üîç Regulations Checked:</strong> NERC CIP, EPA, PUC Standards
                </div>
                <div class="insight-item recommendation-item">
                    <strong>üí° Top Recommendation:</strong> Address Electronic Security Perimeters (30-day timeline)
                    <br><small>Estimated Cost: $50k-$500k</small>
                </div>
                <div class="insight-item recommendation-item">
                    <strong>üìà Business Impact:</strong> Avoid regulatory fines, improve audit readiness
                </div>
            `;
            
            panel.style.display = 'block';
        }

        function displayCustomerInsights(data) {
            const panel = document.getElementById('insightsPanel');
            const content = document.getElementById('insightsContent');
            
            const totalInteractions = data.period.total_interactions;
            const channels = data.channel_analysis.length;
            const topRecommendation = data.recommendations[0];
            
            content.innerHTML = `
                <div class="insight-item">
                    <strong>üìä Journey Analysis:</strong> ${totalInteractions} interactions across ${channels} channels
                </div>
                <div class="insight-item">
                    <strong>üéØ Success Rate:</strong> ${Math.round(data.journey_patterns[0].success_rate * 100)}%
                </div>
                <div class="insight-item">
                    <strong>‚è±Ô∏è Average Resolution:</strong> ${Math.round(data.journey_patterns[0].average_duration_hours)} hours
                </div>
                <div class="insight-item recommendation-item">
                    <strong>üí° Top Recommendation:</strong> ${topRecommendation}
                </div>
                <div class="insight-item recommendation-item">
                    <strong>üìà Business Impact:</strong> Reduce resolution time, improve customer satisfaction
                </div>
                <div class="insight-item">
                    <strong>üîç Channels Analyzed:</strong> ${data.channel_analysis.map(c => c.channel).join(', ')}
                </div>
            `;
            
            panel.style.display = 'block';
        }
    </script>
</body>
</html>